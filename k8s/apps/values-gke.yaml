# GKE cluster values
global:
  environment: gcp-gke
  namespace: apps

# Ingress configuration
# Grafana has its own LoadBalancer (not part of this ingress)
ingress:
  enabled: true
  host: grudapp.com
  className: ""
  annotations:
    kubernetes.io/ingress.class: "gce"
    kubernetes.io/ingress.global-static-ip-name: "grud-ingress-ip"

# Cloud SQL configuration
cloudSql:
  enabled: true
  privateIp: "10.64.0.3"  # Set via --set cloudSql.privateIp

# Secret management - use Google Secret Manager
secrets:
  # For GKE: use External Secrets Operator with Google Secret Manager
  createKubernetesSecrets: false
  useExternalSecrets: true

  # Google Secret Manager configuration
  gcp:
    projectId: "rugged-abacus-483006-r5"
    clusterLocation: europe-west1-b
    clusterName: grud-cluster
    serviceAccountName: grud-secrets-sa

    # Secret names in Google Secret Manager
    jwtSecretName: grud-jwt-secret
    studentDbSecretName: grud-student-db-credentials
    projectDbSecretName: grud-project-db-credentials

databases:
  student:
    # For GKE, these are loaded from Google Secret Manager
    host: ""  # Cloud SQL proxy or IP
    port: 5432

  project:
    host: ""  # Cloud SQL proxy or IP
    port: 5432

studentService:
  enabled: true
  replicaCount: 2
  image:
    repository: europe-west1-docker.pkg.dev/rugged-abacus-483006-r5/grud/student-service
    tag: "0.0.6"
    pullPolicy: Always
  config:
    env: gke
    serverPort: "8080"
    grpcEndpoint: "project-service:50052"
    natsUrl: "nats.infra.svc.cluster.local:4222"
    natsSubject: "student-messages"
    otelEndpoint: "alloy.infra:4317"
    corsOrigins:
      - "https://grudapp.com"
      - "https://admin.grudapp.com"
  database:
    port: "5432"
    name: university
    sslMode: require
    secretName: student-db-secret  # External Secrets creates this name
  useSecrets: true
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  nodeSelector:
    node-type: app
  tolerations:
    - key: workload
      operator: Equal
      value: app
      effect: NoSchedule
  # HPA - Horizontal Pod Autoscaler
  hpa:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilization: 70
    targetMemoryUtilization: 80

projectService:
  enabled: true
  replicaCount: 2
  image:
    repository: europe-west1-docker.pkg.dev/rugged-abacus-483006-r5/grud/project-service
    tag: "0.0.6"
    pullPolicy: Always
  config:
    env: gke
    grpcPort: "50052"
    natsUrl: "nats.infra.svc.cluster.local:4222"
    natsSubject: "student-messages"
    otelEndpoint: "alloy.infra:4317"
  database:
    port: "5432"
    name: projects
    sslMode: require
    secretName: project-db-secret  # External Secrets creates this name
  useSecrets: true
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  nodeSelector:
    node-type: app
  tolerations:
    - key: workload
      operator: Equal
      value: app
      effect: NoSchedule
  # HPA - Horizontal Pod Autoscaler
  hpa:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilization: 70
    targetMemoryUtilization: 80

adminPanel:
  enabled: true
  replicaCount: 1
  image:
    repository: europe-west1-docker.pkg.dev/rugged-abacus-483006-r5/grud/admin-panel
    tag: "0.0.8"
    pullPolicy: Always
  config:
    apiUrl: "https://grudapp.com"
  ingress:
    enabled: true
    host: admin.grudapp.com
  service:
    type: ClusterIP
    port: 80
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  nodeSelector:
    node-type: app
  tolerations:
    - key: workload
      operator: Equal
      value: app
      effect: NoSchedule

# For GKE, databases are managed via Cloud SQL
studentDb:
  enabled: false

projectDb:
  enabled: false
