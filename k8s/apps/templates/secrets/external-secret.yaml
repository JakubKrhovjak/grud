{{- if .Values.secrets.useExternalSecrets }}
---
# External Secret for JWT token (synced from Google Secret Manager)
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: jwt-secret
  namespace: {{ .Values.global.namespace }}
  labels:
    app: apps
    component: secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: jwt-secret
    creationPolicy: Owner
  data:
    - secretKey: jwt-secret
      remoteRef:
        key: {{ .Values.secrets.gcp.jwtSecretName }}

---
# External Secret for Student Database credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: student-db-secret
  namespace: {{ .Values.global.namespace }}
  labels:
    app: apps
    component: secrets
    database: student-db
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: student-db-secret
    creationPolicy: Owner
  dataFrom:
    - extract:
        key: {{ .Values.secrets.gcp.studentDbSecretName }}

---
# External Secret for Project Database credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: project-db-secret
  namespace: {{ .Values.global.namespace }}
  labels:
    app: apps
    component: secrets
    database: project-db
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcpsm-secret-store
    kind: SecretStore
  target:
    name: project-db-secret
    creationPolicy: Owner
  dataFrom:
    - extract:
        key: {{ .Values.secrets.gcp.projectDbSecretName }}
{{- end }}
