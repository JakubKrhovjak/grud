# Production overlay
# Increases resources and replicas for production workloads
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base
  - project-config.yaml
  - student-config.yaml

# Production-specific patches
patches:
  # Increase replicas for all deployments
  - target:
      kind: Deployment
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 3

  # Production resource limits
  - target:
      kind: Deployment
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/memory
        value: 512Mi
      - op: replace
        path: /spec/template/spec/containers/0/resources/limits/cpu
        value: 1000m

  # Increase database replicas
  - target:
      kind: StatefulSet
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 3

  # Set APP_ENV to prod for project-service
  - target:
      kind: Deployment
      name: project-service
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/env/0/value
        value: prod

  # Set APP_ENV to prod for student-service
  - target:
      kind: Deployment
      name: student-service
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/env/0/value
        value: prod

commonAnnotations:
  grud.io/environment: "prod"
